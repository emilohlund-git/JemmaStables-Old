<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="icon" href="../android-chrome-512x512.png">

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-firestore.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <link rel="stylesheet" href="../static/css/main.css">
    <script src="../static/js/firestore.js"></script>
    <title>Jemma Stables</title>
</head>

<body>
    <nav id="navbar" class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a href="index.html" class="navbar-brand"><img id="logo" src="/static/img/Jemma_stables.webp" alt="Logo"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>
    <div class="container" id="häst-container-2">
        <input type="date" name="" id="date">
        <select name="" id="select"></select> till
        <select name="" id="select2"></select>
        <button class="btn btn-primary" type="submit" id="okButton">Lägg till</button>
        <br>
        <h3 id="tider">Tillgängliga tider:</h3>
        <ul class="list-group" id="list">

        </ul>
    </div>
    <script>
        var db = firebase.firestore();
        let times = ["08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00"]
        var months = ["Januari", "Februari", "Mars", "April", "Maj", "Juni", "Juli", "Augusti", "September", "Oktober", "November", "December"]

        times.forEach(function(time) {
            let option = document.createElement("option");
            let option2 = document.createElement("option");
            option.text = time;
            option2.text = time;
            document.getElementById("select").add(option);
            document.getElementById("select2").add(option2);
        });

        d = document.getElementById("date");
        s = document.getElementById("select");
        s2 = document.getElementById("select2");

        document.getElementById("okButton").addEventListener("click", function() {
            let parsedInfo = d.value.toString().split("-");
            let månad = months[parseInt(parsedInfo[parsedInfo.length - 2]) - 1];
            let dag = removeZero(parsedInfo[parsedInfo.length - 1]);
            let tid = s.options[s.selectedIndex].text + "-" + s2.options[s2.selectedIndex].text;
            if (!checkIfTimeExists(tid)) {
                db.collection(månad)
                    .doc(dag).collection("Tider")
                    .add({
                        Tid: tid
                    });
                $("#list").empty();
                getTimesSelectedMonth(månad, dag);
            } else {
                alert("Tiden finns redan inlagd!");
            }
        });

        const removeZero = (s) => {
            return s.replace(/^0+/, '');
        }

        const getTimesSelectedMonth = (month, day) => {
            db.collection(month).doc(day).collection("Tider")
                .get()
                .then(function(querySnapshot) {
                    querySnapshot.forEach(function(doc) {
                        // doc.data() is never undefined for query doc snapshots
                        var li = document.createElement("li");
                        li.classList.add("list-group-item");
                        document.getElementById("list").appendChild(li);
                        li.innerHTML = doc.data().Tid;
                    });
                })
                .catch(function(error) {
                    return error;
                });
        }

        d.onchange = function() {
            $("#list").empty();
            let parsedInfo = d.value.toString().split("-");
            let månad = months[parseInt(parsedInfo[parsedInfo.length - 2]) - 1];
            let dag = removeZero(parsedInfo[parsedInfo.length - 1]);
            getTimesSelectedMonth(månad, dag);
        }


        const checkIfTimeExists = (time) => {
            let times = document.querySelectorAll("li");
            for (i = 0; i < times.length; i++) {
                if (times[i].innerHTML == time) {
                    return true;
                }
            }
        }
    </script>
</body>

</html>